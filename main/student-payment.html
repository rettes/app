<!DOCTYPE html>
<html lang="en">

<!-- student-dashboard-my-courses21:54  -->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Payment</title>

    <!-- Css Files -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/font-awesome.css" rel="stylesheet">
    <link href="css/flaticon.css" rel="stylesheet">
    <link href="css/slick-slider.css" rel="stylesheet">
    <link href="css/prettyphoto.css" rel="stylesheet">
    <link href="build/mediaelementplayer.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <link href="css/color.css" rel="stylesheet">
    <link href="css/color-two.css" rel="stylesheet">
    <link href="css/color-three.css" rel="stylesheet">
    <link href="css/color-four.css" rel="stylesheet">
    <link href="css/responsive.css" rel="stylesheet">
    <style>
        .picture-logo {
            width: 64px;
            height: 80px;
        }
    </style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body onload="loadPage()">

    <!--// Main Wrapper \\-->
    <div class="wm-main-wrapper">

        <!--// Header \\-->
        <header id="wm-header" class="wm-header-one">

            <!--// TopStrip \\-->
            <div class="wm-topstrip">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">

                            <ul class="wm-adminuser-section">
                                <li>
                                    <a id="welcome">Hi, John Teo Tjia Ern.</a>
                                </li>
                                <li>
                                    <a href="#" class="wm-search-btn" data-toggle="modal" data-target="#ModalSearch"><i
                                            class="wmicon-search"></i></a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!--// TopStrip \\-->

            <!--// MainHeader \\-->
            <div class="wm-main-header">
                <div class="container">
                    <div class="row">
                        <div class="col-md-3"><a href="index.html" class="wm-logo"><img src="images/smulogo.png"
                                    width="130px" height="50px alt="></a></div>
                        <div class=" col-md-9">
                            <!--// Navigation \\-->
                            <nav class="navbar navbar-default">
                                <div class="navbar-header">
                                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                                        data-target="#navbar-collapse-1" aria-expanded="true">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                    </button>
                                </div>
                                <div class="collapse navbar-collapse" id="navbar-collapse-1">
                                    <ul class="nav navbar-nav" id="topNav">
                                        <li>
                                            <a href="index.html">Home</a>
                                        </li>

                                        <li>
                                            <a href="courses-grid.html">Course Openings</a>
                                        </li>

                                        <li>
                                            <a href="student-profile.html">Profile</a>
                                        </li>

                                        <li id="payment">
                                            <a href="student-payment.html">Payment</a>
                                        </li>

                                        <li class="wm-megamenu-li" id="logout">
                                            <a href="logout.html">Logout</a>
                                        </li>
                                    </ul>
                                </div>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
            <!--// MainHeader \\-->

        </header>
        <!--// Header \\-->

        <!--// Mini Header \\-->
        <div class="wm-mini-header">
            <span class="wm-blue-transparent"></span>
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="wm-mini-title">
                            <h1 id="dashboard1">Student Dashboard</h1>
                        </div>
                        <div class="wm-breadcrumb">
                            <ul>
                                <li><a href="index.html">Home</a></li>
                                <li><a href="#" id="dashboard2">Student Dashboard</a></li>
                                <li>Payments</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--// Mini Header \\-->

        <!--// Main Content \\-->
        <div class="wm-main-content">

            <!--// Main Section \\-->
            <div class="wm-main-section">
                <div class="container">
                    <div class="row">
                        <aside class="col-md-4">
                        </aside>
                        <div class="col-md-8">
                            <h1 id="msg"></h1>
                            <div class="wm-student-dashboard-courses wm-dashboard-courses" id="paymentList">
                                <div class="wm-plane-title">
                                    <h2>Payments</h2>
                                </div>
                                <div class="wm-article">
                                    <ul>
                                        <li class="wm-courses-start wm-student">
                                            <span>Course ID <br><br></span>
                                        </li>
                                        <li class="wm-student">
                                            <span>Status</span>
                                        </li>
                                        <li class="wm-student">
                                            <span>Payment ID</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <br>
                            <div class="wm-student-dashboard-courses" id="addPayment">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--// Main Section \\-->

            <!--// Main Section \\-->
        </div>
        <!--// Main Content \\-->

        <!--Footer-->
        <footer id="wm-footer" class="wm-footer-one">

            <!--// FooterNewsLatter \\-->
            <div class="wm-footer-newslatter">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <form>

                                <input type="submit" value="Copyrighted by Singapore Management University">
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!--// FooterNewsLatter \\-->

            <!--// FooterWidgets \\-->
            <div class="wm-footer-widget">
                <div class="container">
                    <div class="row">
                        <aside class="widget widget_contact_info col-md-3">
                            <a href="index.html" class="wm-footer-logo"><img src="images/smulogo.png" alt=""
                                    width="197px" height="62px"></a>
                            <ul>
                                <li><i class="wm-color wmicon-pin"></i> 81 Victoria St, Singapore 188065</li>
                                <li><i class="wm-color wmicon-phone"></i> Tel: +65 6828 0100

                                    <br> Fax: +65 6828 0101</li>
                                <li><i class="wm-color wmicon-letter"></i> <a
                                        href="mailto:enquiry@smu.edu.sg">enquiry@smu.edu.sg</a> <a></a>
                            </ul>
                            <div class="wm-footer-icons">
                                <a href="https://www.facebook.com/sgsmu" class="wmicon-social5"></a>
                                <a href="https://twitter.com/sgsmu" class="wmicon-social4"></a>
                                <a href="https://www.linkedin.com/company/singapore-management-university/"
                                    class="wmicon-social3"></a>
                            </div>
                        </aside>


                        <aside class="widget widget_gallery col-md-3">
                            <div class="wm-footer-widget-title">
                                <h5>Some of our Professors</h5>
                            </div>
                            <ul class="gallery">
                                <li><a title="" data-rel="prettyPhoto[gallery1]" href="images/aplin.jpg"><img
                                            class="picture-logo" src="images/aplin.jpg" alt=""></a></li>
                                <li><a title="" data-rel="prettyPhoto[gallery1]" href="images/benjaminjong.jpg"><img
                                            class="picture-logo" src="images/benjaminjong.jpg" alt=""></a></li>
                                <li><a title="" data-rel="prettyPhoto[gallery1]" href="images/bthuynh.jpg"><img
                                            class="picture-logo" src="images/bthuynh.jpg" alt=""></a></li>
                                <li><a title="" data-rel="prettyPhoto[gallery1]" href="images/charlescsy.jpg"><img
                                            class="picture-logo" src="images/charlescsy.jpg" alt=""></a></li>
                                <li><a title="" data-rel="prettyPhoto[gallery1]" href="images/cposkitt.jpg"><img
                                            class="picture-logo" src="images/cposkitt.jpg" alt=""></a></li>
                                <li><a title="" data-rel="prettyPhoto[gallery1]" href="images/davidlo.jpg"><img
                                            class="picture-logo" src="images/davidlo.jpg" alt=""></a></li>
                                <li><a title="" data-rel="prettyPhoto[gallery1]" href="images/lkshar.jpg"><img
                                            class="picture-logo" src="images/lkshar.jpg" alt=""></a></li>
                                <li><a title="" data-rel="prettyPhoto[gallery1]" href="images/rajesh.jpg"><img
                                            class="picture-logo" src="images/rajesh.jpg" alt=""></a></li>
                                <li><a title="" data-rel="prettyPhoto[gallery1]" href="images/rafaelbarros.jpg"><img
                                            class="picture-logo" src="images/rafaelbarros.jpg" alt=""></a></li>
                            </ul>
                        </aside>
                    </div>
                </div>
            </div>

        </footer>
        <div class="clearfix"></div>
        <!-- ModalSearch Box -->
        <script>
            if (userEmail == null && localStorage.getItem("email") != null) {
                var userEmail = localStorage.getItem("userEmail");
            }
            if (userID == null && localStorage.getItem("userID") != null) {
                var userID = localStorage.getItem("userID");
            }
            if (userName == null && localStorage.getItem("userName") != null) {
                var userName = localStorage.getItem("userName");
            }
            if (userType == null && localStorage.getItem("userType") != null) {
                var userType = localStorage.getItem("userType");
            }
            if (localStorage.getItem("email") == null) {
                window.location = "http://../login/index.html";
                Redirect();
            }

            if (userType != "admin" && userType != "student") {
                window.location = "http://./index.html";
                Redirect();
            }

            var localhost_5013 = `http://5652914999a0.ngrok.io`;

            //-------------------------------------------------------------------------------------------------------------//

            function loadPage() {
                document.getElementById("welcome").innerHTML = "Hi, " + userID;
                if (userType == "professor") {
                    document.getElementById("payment").id = "add"

                    var item = `
                <a href=# >TA openings</a>
                <ul class="wm-dropdown-menu">
                    <li><a href="add-courses.html" id="addOpening">Add TA Opening</a></li>
                    <li class="active" id="taTenure"><a href="add-tenure.html">Add TA Tenure</a></li>
                    <li class="active" id="taManage"><a href="manage-applications.html">Manage Applications</a></li>
                </ul>`;

                    document.getElementById("add").innerHTML = item
                } else if (userType == "admin") {
                    let newLi = document.createElement("LI");
                    newLi.id = "add"
                    let linkNode = document.createElement("A");
                    linkNode.innerHTML = "TA Openings";
                    linkNode.href = "#";
                    newLi.appendChild(linkNode);
                    var topNav = document.getElementById("topNav");
                    topNav.insertBefore(newLi, document.getElementById("logout"));

                    var item = `<ul class="wm-dropdown-menu">
                    <li><a href="add-courses.html" id="addOpening">Add TA Opening</a></li>
                    <li class="active" id="taApplications"><a href="ta-applications.html">TA Applications</a></li>
                </ul>`;

                    document.getElementById("add").innerHTML += item
                }
            }

            if (userType == "admin") {
                document.getElementById("dashboard1").innerHTML = "Admin Dashboard";
                document.getElementById("dashboard2").innerHTML = "Admin Dashboard";

                loadPayments();
            } else if (userType == "student") {
                loadPaymentsById(userID);
            }

            function loadPayments() {

                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {

                    if (xhttp.readyState == 4 && xhttp.status == 200) {
                        var item = JSON.parse(xhttp.responseText);

                        var toAdd = "";
                        for (let payment in item["payments"]) {
                            // console.log(payment)
                            let mod_id = item["payments"][payment]["mod_id"];
                            let payment_amt = item["payments"][payment]["payment_amt"];
                            let payment_date = ''
                            if (item["payments"][payment]["payment_date"] != null) {
                                payment_date = item["payments"][payment]["payment_date"].slice(0, -13);
                            }
                            let payment_status = item["payments"][payment]["payment_status"];
                            let payment_label = payment_status.charAt(0).toLowerCase() + payment_status.slice(1)

                            let payment_id = item["payments"][payment]["payment_id"];
                            let student_id = item["payments"][payment]["student_id"];

                            let paypal = '';
                            let space = ''
                            if (payment_label == "unpaid") {
                                payment_label = "in-Progress"
                                paypal =
                                    `<br><br><div class="paypal-button" id="${payment_id}" style="float: left"></div>`;
                                space = '<br';

                            }

                            toAdd += `<div class="wm-article payment-details">
									<ul>
										<li class="wm-courses-start">
											<div class="wm-statement-started-text">
												<h6><a href="#">${mod_id}</a></h6>
												<span><a href="#" class="wmicon-tag"></a>$${payment_amt}</span>
                                                <span><a href="#" class="wmicon-time2"></a>${payment_date}</time></span>
                                                <span><a href="#" class="wmicon-people"></a>Student ID: ${student_id}</span>
                                                ${paypal}
											</div>
										</li>										
										<li>
											<a class="wm-status-courses wm-${payment_label}" href="#">${payment_status}</a>
                                            ${space}
										</li>
                                        <li>
											<small>${payment_id}</small>
                                            ${space}
                                        </li>

									</ul>									
								</div>`

                        }
                        document.getElementById("paymentList").innerHTML += toAdd;
                        generateButton()
                    }

                }

                url = `${localhost_5013}/get_all`
                xhttp.open("GET", url, true);
                xhttp.send();
            }

            function loadPaymentsById(userID) {

                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {

                    if (xhttp.readyState == 4 && xhttp.status == 200) {
                        var item = JSON.parse(xhttp.responseText);
                        var toAdd = "";
                        for (let payment in item["payments"]) {
                            // console.log(payment)
                            let mod_id = item["payments"][payment]["mod_id"];
                            let payment_amt = item["payments"][payment]["payment_amt"];
                            let payment_date = item["payments"][payment]["payment_date"].slice(0, -13);
                            let payment_status = item["payments"][payment]["payment_status"];
                            let payment_label = payment_status.charAt(0).toLowerCase() + payment_status.slice(1)
                            let payment_id = item["payments"][payment]["payment_id"];

                            if (payment_label == "in progress") {
                                payment_label = "in-Progress"
                            }


                            toAdd += `<div class="wm-article">
									<ul>
										<li class="wm-courses-start">
											<div class="wm-statement-started-text">
												<h6><a href="#">${mod_id}</a></h6>
												<span><a href="#" class="wmicon-tag"></a>$${payment_amt}</span>
                                                <span><a href="#" class="wmicon-time2"></a>${payment_date}</time></span>
											</div>
										</li>										
										<li>
											<a class="wm-status-courses wm-${payment_label}" href="#">${payment_status}</a>
										</li>
                                        <li>
											<h6>${payment_id}</h6>
                                        </li>

									</ul>									
								</div>`
                        }

                        document.getElementById("paymentList").innerHTML += toAdd;

                    }

                }

                url = `${localhost_5013}/get_payment_by_id/` + userID
                xhttp.open("GET", url, true);
                xhttp.send();
            }

            function updatePayment(payment_id, payment_details) {

                var today = new Date();
                var dd = String(today.getDate()).padStart(2, '0');
                var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
                var yyyy = today.getFullYear();
                today = yyyy + '-' + mm + '-' + dd;

                var payment_date = today;

                var payment = {
                    payment_id: payment_id,
                    payment_details: payment_details,
                    payment_date: payment_date
                }

                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {

                    if (xhttp.readyState == 4 && xhttp.status == 200) {
                        var item = JSON.parse(xhttp.responseText);

                        document.getElementById("msg").innerHTML = item

                        if (item == "Payment updated") {

                            document.getElementById("msg").style.color = "green";
                            document.getElementById("msg").style.textAlign = "center";

                            $(".wm-article.payment-details").remove();
                            loadPayments();

                        } else {
                            document.getElementById("msg").style.color = "red";
                            document.getElementById("msg").style.textAlign = "center";
                        }

                    }
                }

                let parameter = Object.entries(payment).map(([key, val]) => `${key}=${val}`).join('&');
                url = `${localhost_5013}/update_tenure/` + parameter
                xhttp.open("GET", url, true);
                xhttp.send();

            }
        </script>
        <script src="https://www.paypalobjects.com/api/checkout.js"></script>
        <script>
            function generateButton() {
                $cost = '500';
                document.querySelectorAll('.paypal-button').forEach(function (selector) {
                    paypal.Button.render({
                        // Configure environment
                        env: 'sandbox',
                        client: {
                            sandbox: 'AUeZaD56BGfH4-z8TGcUA2H6Bqgg80VIowCG5WM3qSZAEGBkacCgoMUq5TCPa6BoS0VTqNzTCl6IlEze',
                            production: 'demo_production_client_id'
                        },
                        // Customize button (optional)
                        locale: 'en_US',
                        style: {
                            size: 'small',
                            color: 'gold',
                            shape: 'pill',
                        },

                        // Enable Pay Now checkout flow (optional)
                        commit: true,

                        // Set up a payment
                        payment: function (data, actions) {
                            return actions.payment.create({
                                transactions: [{
                                    amount: {
                                        total: $cost,
                                        currency: 'SGD'
                                    }
                                }]
                            });
                        },

                        // Execute the payment
                        onAuthorize: function (data, actions) {
                            return actions.payment.execute().then(function () {
                                // Show a confirmation message to the buyer
                                window.alert('Thank you for your patronage!');
                                updatePayment(selector.id, data.paymentID);
                            });
                        }
                    }, selector);
                });
            }
        </script>
        <!-- jQuery (necessary for JavaScript plugins) -->
        <script type="text/javascript" src="script/jquery.js"></script>
        <script type="text/javascript" src="script/modernizr.js"></script>
        <script type="text/javascript" src="script/bootstrap.min.js"></script>
        <script type="text/javascript" src="script/jquery.prettyphoto.js"></script>
        <script type="text/javascript" src="script/jquery.countdown.min.js"></script>
        <script type="text/javascript" src="script/fitvideo.js"></script>
        <script type="text/javascript" src="script/skills.js"></script>
        <script type="text/javascript" src="script/slick.slider.min.js"></script>
        <script type="text/javascript" src="script/waypoints-min.js"></script>
        <script type="text/javascript" src="build/mediaelement-and-player.min.js"></script>
        <script type="text/javascript" src="script/isotope.min.js"></script>
        <script type="text/javascript" src="script/jquery.nicescroll.min.js"></script>
        <!-- <script type="text/javascript" src="script/functions.js"></script> -->

</body>

<!-- student-dashboard-my-courses21:55  -->

</html>